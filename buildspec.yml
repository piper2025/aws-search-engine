version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.10
    commands:
      - echo "Installing dependencies for PDFtoTXT..."
      - pip install pypdf typing_extensions -t PDFtoTXT/
      
      - echo "Installing dependencies for Upload-to-search..."
      - pip install requests requests_aws4auth -t Upload-to-search/
      
  build:
    commands:
      - echo "Packaging infrastructure..."
      # This points to your template inside the new clean PDFtoTXT folder
      - aws cloudformation package --template-file PDFtoTXT/pdftotxt.yaml --s3-bucket search-artifacts-store --output-template-file lambdaoutput.yaml
      
  post_build:
    commands:
      - echo "Deploying..."
      - aws cloudformation deploy --template-file lambdaoutput.yaml --stack-name pdf-automation-v1 --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM --no-fail-on-empty-changeset